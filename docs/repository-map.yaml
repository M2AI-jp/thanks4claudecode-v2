# Repository Map
#
# リポジトリ内の全ファイルマッピング（自動生成）
#
# 生成スクリプト: .claude/hooks/generate-repository-map.sh
# 更新タイミング: playbook 完了時
#
# このファイルは自動生成されます。手動編集は上書きされます。

meta:
  generated: "2025-12-17 00:02:57"
  generator: ".claude/hooks/generate-repository-map.sh"
  total_files: 229

hooks:
  directory: .claude/hooks/
  count: 31
  files:
    - name: "archive-playbook.sh"
      trigger: "PostToolUse:Edit"
      description: "archive-playbook.sh - playbook 完了時の自動アーカイブ提案"
    - name: "check-coherence.sh"
      trigger: "PreToolUse:Bash"
      description: "check-coherence.sh - 簡略版：state.md と playbook の整合性チェック"
    - name: "check-file-dependencies.sh"
      trigger: "PreToolUse:Edit"
      description: "check-file-dependencies.sh - ファイル依存関係チェック Hook"
    - name: "check-main-branch.sh"
      trigger: "PreToolUse:*"
      description: "check-main-branch.sh - main ブランチでの作業をブロック"
    - name: "check-protected-edit.sh"
      trigger: "PreToolUse:Edit"
      description: "check-protected-edit.sh - 保護対象ファイルの編集をブロック"
    - name: "cleanup-hook.sh"
      trigger: "PostToolUse:Edit"
      description: "cleanup-hook.sh - playbook 完了時のテンポラリファイル自動クリーンアップ"
    - name: "consent-guard.sh"
      trigger: "PreToolUse:Edit"
      description: "consent-guard.sh - 合意プロセス強制フック"
    - name: "create-pr-hook.sh"
      trigger: "PostToolUse:Edit"
      description: "create-pr-hook.sh - playbook 完了時の PR 自動作成フック"
    - name: "create-pr.sh"
      trigger: "utility"
      description: "create-pr.sh - Phase/Playbook 完了時の自動 PR 作成"
    - name: "critic-guard.sh"
      trigger: "PreToolUse:Edit"
      description: "critic-guard.sh - state: done への変更を構造的にブロック"
    - name: "depends-check.sh"
      trigger: "PreToolUse:Edit"
      description: "depends-check.sh - Phase の depends_on を検証"
    - name: "doc-freshness-check.sh"
      trigger: "PostToolUse:Read"
      description: "doc-freshness-check.sh - PostToolUse:Read Hook: ドキュメント鮮度チェック"
    - name: "executor-guard.sh"
      trigger: "PreToolUse:Edit"
      description: "executor-guard.sh - Phase の executor を構造的に強制"
    - name: "failure-logger.sh"
      trigger: "utility"
      description: "failure-logger.sh - 失敗パターン記録ユーティリティ"
    - name: "generate-repository-map.sh"
      trigger: "utility"
      description: "generate-repository-map.sh - 全ファイル自動マッピングシステム"
    - name: "init-guard.sh"
      trigger: "PreToolUse:*"
      description: "init-guard.sh - セッション開始時の強制的自己認識ガード"
    - name: "lint-check.sh"
      trigger: "PreToolUse:Bash"
      description: "lint-check.sh - 静的解析チェック Hook"
    - name: "log-subagent.sh"
      trigger: "PostToolUse:Task"
      description: "log-subagent.sh - Subagent 発動ログ記録 + critic 結果処理"
    - name: "merge-pr.sh"
      trigger: "utility"
      description: "merge-pr.sh - PR の自動マージスクリプト"
    - name: "playbook-guard.sh"
      trigger: "PreToolUse:Edit"
      description: "playbook-guard.sh - Edit/Write 時に playbook=null ならブロック"
    - name: "pre-bash-check.sh"
      trigger: "PreToolUse:Bash"
      description: "pre-bash-check.sh - Bash コマンド実行前のチェック"
    - name: "pre-compact.sh"
      trigger: "PreCompact:*"
      description: "pre-compact.sh - PreCompact Hook: 完全な状態スナップショット保存"
    - name: "prompt-guard.sh"
      trigger: "UserPromptSubmit:*"
      description: "prompt-guard.sh - UserPromptSubmit Hook"
    - name: "scope-guard.sh"
      trigger: "PreToolUse:Edit"
      description: "scope-guard.sh - done_criteria/done_when の無断変更を検出"
    - name: "session-end.sh"
      trigger: "SessionEnd:*"
      description: "session-end.sh - セッション終了時に四つ組整合性チェック + リマインド"
    - name: "session-start.sh"
      trigger: "SessionStart:*"
      description: "session-start.sh - LLMの自己認識を形成し、LOOPを開始させる"
    - name: "stop-summary.sh"
      trigger: "Stop:*"
      description: "stop-summary.sh - Stop Hook: Phase 状態サマリー + 整合性チェック"
    - name: "subtask-guard.sh"
      trigger: "PreToolUse:Edit"
      description: "subtask-guard.sh - subtask の 3 検証を強制"
    - name: "system-health-check.sh"
      trigger: "utility"
      description: "system-health-check.sh - SessionStart 統合: システム健全性チェック"
    - name: "test-hooks.sh"
      trigger: "utility"
      description: "test-hooks.sh - Hook 機能カタログスペック検証"
    - name: "update-tracker.sh"
      trigger: "PostToolUse:Edit"
      description: "update-tracker.sh - PostToolUse:Edit/Write Hook: 変更追跡と自動更新提案"

agents:
  directory: .claude/agents/
  count: 8
  files:
    - name: "codex-delegate"
      description: "Codex CLI をラップし、コンテキスト膨張を防止する SubAgent"
    - name: "critic"
      description: "各 subtask の test_command を実行し、PASS/FAIL を判定する"
    - name: "health-checker"
      description: "description: システム状態の定期監視。state.md/playbook の整合性、git 状態、ファイル存在確認などを行う。"
    - name: "plan-guard"
      description: "description: PROACTIVELY checks 3-layer plan coherence at session start. Rejects or reconfirms when no plan exists or user prompt is unrelated to existing plan. LLM-led session flow."
    - name: "pm"
      description: "重要"
    - name: "reviewer"
      description: "description: Use this agent for code and design reviews. Evaluates code quality, design patterns, and best practices. Provides constructive feedback for improvements."
    - name: "setup-guide"
      description: "description: AUTOMATICALLY guides setup process when focus.current=setup. Conducts hearing, environment setup, and Skills generation. Does not ask unnecessary questions."

skills:
  directory: .claude/skills/
  count: 11
  files:
    - name: "consent-process"
      description: "合意プロセス（CONSENT）- ユーザープロンプトの誤解釈防止"
    - name: "context-externalization"
      description: "コンテキスト外部化 - チャット履歴に依存しない状態管理"
    - name: "context-management"
      description: "チャット履歴に依存しない状態管理。プロンプト→意図→処理→結果を外部ファイルに記録。"
    - name: "deploy-checker"
      description: "デプロイ準備・検証専門スキル"
    - name: "execution-management"
      description: "description: 並列実行制御とリソース配分のガイドライン。タスク実行の最適化を支援。"
    - name: "frontend-design"
      description: "プロダクション品質のフロントエンドインターフェースを作成する"
    - name: "lint-checker"
      description: "コード品質チェック専門スキル"
    - name: "plan-management"
      description: "description: Multi-layer planning and playbook management. Use when creating playbooks, transitioning phases, or managing plan hierarchy. Triggers on \"plan\", \"playbook\", \"phase\", \"roadmap\", \"milestone"
    - name: "post-loop"
      description: "POST_LOOP - playbook 完了後の自動処理"
    - name: "state"
      description: "description: このワークスペースの state.md 管理、playbook 運用、レイヤー構造の専門知識。state.md の更新、focus の切り替え、done_criteria の判定、CRITIQUE の�"
    - name: "test-runner"
      description: "テスト実行・検証専門スキル"

frameworks:
  directory: .claude/rules/frameworks/
  count: 0
  files: []

commands:
  directory: .claude/commands/
  count: 8
  files:
    - name: "/crit"
      description: "現在の `goal.done_criteria` の達成状況を CRITIQUE してください。"
    - name: "/focus"
      description: "state.md の `focus.current` を指定したレイヤーに変更してください。"
    - name: "/lint"
      description: "state.md と playbook の整合性をチェックしてください。"
    - name: "/playbook-init"
      description: "このフローは構造的に強制される。手順をスキップしてはならない。"
    - name: "/rollback"
      description: "Git ロールバックを実行します。"
    - name: "/state-rollback"
      description: "state.md のバックアップと復元を管理します。"
    - name: "/task-start"
      description: "標準タスク開始コマンド。全てのタスクは project.md からの導出を経由する。"
    - name: "/test"
      description: "`.claude/tests/` 配下のテストを実行してください。"

docs:
  directory: docs/
  count: 11
  files:
    - name: "CLAUDE.md"
      description: "ドキュメント - 仕様書・運用ルール"
    - name: "archive-operation-rules.md"
      description: "目的"
    - name: "artifact-management-rules.md"
      description: "目的"
    - name: "criterion-validation-rules.md"
      description: "criterion（done_criteria の単位）の検証ルール"
    - name: "extension-system.md"
      description: "公式リファレンスに基づく発火タイミング・トリガー・連携の完全ガイド"
    - name: "folder-management.md"
      description: "全フォルダの役割、テンポラリ/永続区分、削除タイミングを定義"
    - name: "git-operations.md"
      description: "設計方針"
    - name: "hook-responsibilities.md"
      description: "各 Hook の単一責任を明示（SOLID 原則: Single Responsibility Principle）"
    - name: "session-management.md"
      description: "M023: セッション管理ガイド - Named Sessions と Plan Mode の活用"
    - name: "toolstack-patterns.md"
      description: "3 つのツールスタックパターンと設定ガイド"

plan:
  directory: plan/
  subdirectories:
    active:
      description: "進行中の playbook"
      count: 1
    archive:
      description: "完了した playbook のアーカイブ"
      count: 51
    template:
      description: "playbook テンプレート"
      count: 7

root:
  description: "ルートディレクトリの主要ファイル"
  files:
    - name: "CLAUDE.md"
      description: "【即時実行】このファイルを読んだ直後、INIT セクションを実行せよ。[自認]出力までユーザーに応答するな。違反 → init-guard.sh がブロック（exit 2）"
    - name: "AGENTS.md"
      description: "このファイルは純粋なコーディングルール。"
    - name: "README.md"
      description: "**Claude Code と一緒に開発を始めるためのテンプレート。**"
    - name: "state.md"
      description: "現在地を示す Single Source of Truth"
    - name: ".gitignore"
      description: ""
    - name: ".mcp.json"
      description: ""

summary:
  hooks: 31
  agents: 8
  skills: 11
  frameworks: 0
  commands: 8
  docs: 11
  plan_active: 1
  plan_archive: 51
  plan_template: 7
  total: 229

# ==============================================================================
# System Specification (M025)
# Claude の行動ルールと自己認識に必要な情報
# ==============================================================================

system_specification:
  description: "Claude の行動ルールと Hook 連鎖の Single Source of Truth"

  init_flow:
    description: "セッション開始時の必須フロー"
    required_reads:
      - state.md（現在地・goal・milestone）
      - plan/project.md（プロジェクト計画）
      - playbook（playbook.active から特定、なければ null）
      - docs/repository-map.yaml（全ファイルマッピング）
    steps:
      - "必須ファイル Read"
      - "git branch/status 取得"
      - "playbook=null → pm SubAgent"
      - "[自認] 出力"
      - "LOOP 開始"

  loop_flow:
    description: "作業ループのフロー"
    steps:
      - "subtasks を読む"
      - "executor に応じて実行"
      - "test_command で PASS/FAIL 判定"
      - "全 PASS → CRITIQUE()"
      - "PASS → 次 phase、FAIL → 修正"

  post_loop_flow:
    description: "playbook 完了後のフロー"
    steps:
      - "自動コミット"
      - "playbook アーカイブ"
      - "project.milestone 更新"
      - "/clear 推奨アナウンス"
      - "次 milestone → pm"

  hook_chains:
    description: "Hook の発火順序と連鎖関係"
    PreToolUse_Edit:
      trigger: "PreToolUse:Edit"
      order:
        - init-guard.sh
        - check-main-branch.sh
        - consent-guard.sh
        - check-protected-edit.sh
        - playbook-guard.sh
        - depends-check.sh
        - check-file-dependencies.sh
        - critic-guard.sh
        - scope-guard.sh
        - executor-guard.sh
        - subtask-guard.sh
        - consent-guard.sh
        - check-protected-edit.sh
        - playbook-guard.sh
        - check-file-dependencies.sh
        - critic-guard.sh
        - scope-guard.sh
        - executor-guard.sh
        - subtask-guard.sh
        - pre-bash-check.sh
        - check-coherence.sh
        - lint-check.sh
    PostToolUse_Edit:
      trigger: "PostToolUse:Edit"
      order:
        - log-subagent.sh
        - doc-freshness-check.sh
        - archive-playbook.sh
        - cleanup-hook.sh
        - create-pr-hook.sh
        - update-tracker.sh
        - update-tracker.sh
    SessionStart:
      trigger: "SessionStart"
      order:
        - session-start.sh

  behavior_rules:
    description: "CLAUDE.md から抽出した行動ルール"
    core_principles:
      - "pdca_autonomy: playbook 完了 → milestone 更新 → 次 playbook 自動作成"
      - "tdd_first: done_criteria = テスト仕様、根拠必須"
      - "validation: critic は frameworks/ を参照"
      - "plan_based: playbook=null で Edit/Write → ブロック"
      - "git_branch_sync: 1 playbook = 1 branch"
    mandatory_outputs:
      - "[自認]: セッション開始時"
      - "[理解確認]: Edit/Write 前"
    prohibited_actions:
      - 確認を求める、許可を求める、選ばせる（安全上の例外を除く）
      - done_criteria 確認なしで「完了しました」
      - 保護対象ファイルを無断で編集
      - playbook=null で Edit/Write を実行
      - main ブランチで直接作業
      - critic なしで phase を done にする（絶対禁止）
      - ユーザーに聞かずに done_criteria を推測で定義する【報酬詐欺】
      - pm SubAgent を経由せずに直接 playbook を作成する
      - playbook 完了時に /clear を案内せずに次に進む

# ==============================================================================
# 変更履歴
# ==============================================================================
changelog:
  - date: "2025-12-17 00:02:57"
    action: "auto-generated"
    description: "playbook 完了時に自動生成"
