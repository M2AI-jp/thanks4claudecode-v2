# AGENTS.md（コーディングルール）

> **このファイルは純粋なコーディングルール。**
> **運用ルール（state.md 更新等）は CLAUDE.md を参照。**

---

## 1. あなたの役割

- **設計・実装・レビュー** を一貫して担当
- コードの品質に責任を持つ
- CLAUDE.md の LOOP に従い、done_criteria を満たすまで作業を続ける

---

## 2. コーディング原則

### 必要最小構成の原則

```
✅ 依頼された内容のみを実装
✅ 余計なファイル・コードを作らない
✅ 対処療法的・場当たり的な対応を禁止
✅ 動作する最小のコードを書く
```

### 単一責任の原則

```
✅ 1つの関数 = 1つの責任
✅ 1つのファイル = 1つの目的
✅ 変更理由が複数ある場合は分割を検討
```

### 可読性優先

```
✅ 自己文書化コード（名前で意図を伝える）
✅ コメントは「なぜ」を書く（「何を」はコードで表現）
✅ 複雑なロジックは関数に切り出す
✅ マジックナンバーは定数化
```

---

## 3. セキュリティルール

### 絶対禁止

```
❌ .env ファイルをコミット
❌ APIキー・シークレットをコードに埋め込み
❌ ハードコードされたパスワード
❌ eval() の使用（ユーザー入力を含む場合）
❌ 未検証の外部入力をそのまま使用
```

### 推奨

```
✅ シークレットは環境変数で管理
✅ 入力値は常にバリデーション
✅ SQL は必ずパラメータ化クエリ
✅ ユーザー入力は常にサニタイズ
```

---

## 4. エラーハンドリング

### 原則

```
✅ 予期されるエラーは明示的にハンドリング
✅ エラーメッセージは具体的に
✅ スタックトレースはログに残す（本番では非表示）
✅ リカバリー可能な場合はリトライロジック検討
```

### アンチパターン

```
❌ 空の catch ブロック
❌ 汎用的な "Error occurred" メッセージ
❌ エラーを握りつぶして処理続行
```

---

## 5. テストルール

### テストの種類

| 種類 | 目的 | タイミング |
|------|------|-----------|
| 単体テスト | 関数・クラスの動作確認 | 実装と同時 |
| 統合テスト | コンポーネント間連携確認 | 機能完成後 |
| E2E テスト | 実機での挙動確認 | ユーザー確認時 |

### テスト作成原則

```
✅ AAA パターン（Arrange, Act, Assert）
✅ テスト名で何をテストするか明示
✅ 1テスト = 1アサーション（理想）
✅ モック・スタブは最小限に
```

---

## 6. コードレビュー観点

コードを書く際に意識すべきレビュー観点。CRITIQUE 時にも使用。

### チェックリスト

```
□ 機能要件を満たしているか
□ 必要最小構成になっているか
□ セキュリティルールに違反していないか
□ エラーハンドリングは適切か
□ テストは書かれているか
□ 既存コードとの整合性は取れているか
□ パフォーマンス上の問題はないか
```

---

## 7. 参照先

| 情報 | 参照先 |
|------|-------|
| 運用ルール | CLAUDE.md |
| 設計思想・失敗パターン | CONTEXT.md |
| 現在地・done_criteria | state.md |
