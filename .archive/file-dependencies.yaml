# ==============================================================================
# file-dependencies.yaml - ファイル依存関係マップ
# ==============================================================================
# あるファイルを変更したとき、確認すべき関連ファイルを定義
#
# 使用箇所:
#   - check-file-dependencies.sh (PreToolUse Hook)
#   - LLM が編集前に参照
#
# 形式:
#   "ファイルパス":
#     affects: [影響を受けるファイルリスト]
#     reason: "なぜ影響を受けるか"
#     check_level: required | recommended | optional
# ==============================================================================

version: "1.0.0"
updated: "2025-12-04"

# ==============================================================================
# 計画階層（6層）の依存関係
# ==============================================================================
# vision → meta-roadmap → CONTEXT.md → roadmap → playbook → task

plan_hierarchy:
  "plan/vision.md":
    affects:
      - CONTEXT.md
      - plan/meta-roadmap.md
      - plan/roadmap.md
    reason: "最上位レイヤー。存在意義やオーケストレーション設計の変更は全下位レイヤーに影響"
    check_level: required

  "plan/meta-roadmap.md":
    affects:
      - plan/roadmap.md
      - CONTEXT.md
    reason: "roadmap 改善計画。デバッグフェーズやフィードバックループの変更は roadmap に影響"
    check_level: required

  "plan/roadmap.md":
    affects:
      - state.md
      - spec.yaml
      - plan/meta-roadmap.md
    reason: "中長期計画。マイルストーンや担当者アサインの変更は state.md の plan_hierarchy に影響"
    check_level: required

  "plan/active/playbook-*.md":
    affects:
      - state.md
    reason: "playbook の Phase 変更は state.md の goal.done_criteria に影響"
    check_level: required

# ==============================================================================
# 設計・仕様ファイルの依存関係
# ==============================================================================

design_files:
  "CONTEXT.md":
    affects:
      - CLAUDE.md
      - spec.yaml
    reason: "設計思想の変更は LLM 行動指針と実装仕様に影響"
    check_level: required

  "CLAUDE.md":
    affects:
      - .claude/CLAUDE-ref.md
    reason: "行動指針の変更はリファレンスと整合性を保つ必要"
    check_level: required

  ".claude/CLAUDE-ref.md":
    affects:
      - CLAUDE.md
    reason: "詳細ルールの変更は本体との整合性を保つ必要"
    check_level: required

  "spec.yaml":
    affects:
      - .claude/hooks/*.sh
      - .claude/settings.json
      - CLAUDE.md
    reason: "仕様変更は実装（Hook）と行動指針に影響"
    check_level: required

  "AGENTS.md":
    affects: []
    reason: "Codex へのコーディングルール。他ファイルへの影響は少ない"
    check_level: optional

# ==============================================================================
# 状態管理ファイルの依存関係
# ==============================================================================

state_files:
  "state.md":
    affects:
      - "現在の active_playbook"
    reason: "状態変更は playbook と連動。ただし state.md は頻繁に更新されるため、逆方向の影響は限定的"
    check_level: recommended
    note: "state.md は他ファイルから影響を受けることが多い（逆方向依存）"

# ==============================================================================
# Hook / 実装ファイルの依存関係
# ==============================================================================

implementation:
  ".claude/hooks/lib/common.sh":
    affects:
      - .claude/hooks/*.sh
    reason: "共通ライブラリの変更は全 Hook に影響"
    check_level: required

  ".claude/settings.json":
    affects: []
    reason: "設定変更は Hook の発動タイミングに影響するが、Hook コード自体は変更不要"
    check_level: optional

  ".claude/protected-files.txt":
    affects:
      - .claude/hooks/check-protected-edit.sh
    reason: "保護対象リストの変更は Hook の動作に影響"
    check_level: recommended

  ".claude/file-dependencies.yaml":
    affects:
      - .claude/hooks/check-file-dependencies.sh
    reason: "依存関係マップの変更は依存チェック Hook に影響"
    check_level: required

# ==============================================================================
# 逆方向依存（このファイルが変更されたら、これらが影響を与える可能性）
# ==============================================================================
# NOTE: 通常は「affects」で十分だが、理解を助けるために記載

reverse_dependencies:
  "state.md":
    affected_by:
      - plan/roadmap.md
      - plan/active/playbook-*.md
      - spec.yaml

  "CLAUDE.md":
    affected_by:
      - CONTEXT.md
      - spec.yaml

  ".claude/hooks/*.sh":
    affected_by:
      - spec.yaml
      - .claude/hooks/lib/common.sh

# ==============================================================================
# チェック除外パターン
# ==============================================================================

exclude_patterns:
  - "*.log"
  - "*.tmp"
  - ".git/*"
  - "node_modules/*"
  - ".claude/logs/*"
  - ".claude/.session-init/*"
